/*
(c) 2012 Uzi Kilon, Splunk Inc.
Backbone Poller 0.2.5
https://github.com/uzikilon/backbone-poller
Backbone Poller may be freely distributed under the MIT license.
*/
(function(t,e){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],e):t.Backbone.Poller=e(t._,t.Backbone)})(this,function(t,e){"use strict";function i(e){return t.find(h,function(t){return t.model===e})}function o(t,e){this.model=t,this.set(e)}function n(e){if(e.options.delayed)return s(e),void 0;if(r(e)){var i=t.extend({},e.options,{success:function(){e.trigger("success",e.model),s(e)},error:function(){var t=e.xhr;e.stop({silent:!0}),e.trigger("error",e.model,t)}});e.trigger("fetch",e.model),e.xhr=e.model.fetch(i)}}function s(e){r(e)&&(e.options.delayed=!1,e.timeoutId=t.delay(n,e.options.delay,e))}function r(t){return t.options.active?t.options.condition(t.model)!==!0?(t.stop({silent:!0}),t.trigger("complete",t.model),!1):!0:void 0}var c={delay:1e3,condition:function(){return!0}},u=["start","stop","fetch","success","error","complete"],h=[],d={get:function(t,e){var n=i(t);return n?n.set(e):(n=new o(t,e),h.push(n)),e&&e.autostart===!0&&n.start({silent:!0}),n},size:function(){return h.length},reset:function(){for(;h.length;)h.pop().stop()}};return t.extend(o.prototype,e.Events,{set:function(i){return this.off(),this.options=t.extend({},c,i||{}),t.each(u,function(e){var i=this.options[e];t.isFunction(i)&&this.on(e,i,this)},this),this.model instanceof e.Model&&this.model.on("destroy",this.stop,this),this.stop({silent:!0})},start:function(t){return this.active()||(t&&t.silent||this.trigger("start",this.model),this.options.active=!0,n(this)),this},stop:function(t){return t&&t.silent||this.trigger("stop",this.model),this.options.active=!1,this.xhr&&this.xhr.abort&&this.xhr.abort(),this.xhr=null,clearTimeout(this.timeoutId),this.timeoutId=null,this},active:function(){return this.options.active===!0}}),d});