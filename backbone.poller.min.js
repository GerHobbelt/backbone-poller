// (c) 2012 Uzi Kilon, Splunk Inc.
// Backbone Poller 0.1
// https://github.com/uzikilon/backbone-poller
// Backbone Poller may be freely distributed under the MIT license.
!function(e,t,n){"use strict";function o(e){if(e.active()!==!0){e.stop({silent:!0});return}var n=t.extend({},e.options,{success:function(){e.trigger("success",e.model),e.options.condition(e.model)!==!0?(e.trigger("complete",e.model),e.stop({silent:!0})):e.timeoutId=t.delay(o,e.options.delay,e)},error:function(){e.stop({silent:!0}),e.trigger("error",e.model)}});e.trigger("fetch",e.model),e.xhr=e.model.fetch(n)}var r={delay:1e3,condition:function(){return!0}},i=["start","stop","success","error","complete","fetch"],s=function(t,n){this.model=t,this.set(n)};t.extend(s.prototype,n.Events,{set:function(e){return this.options=t.extend({},r,e||{}),t.each(i,function(e){var t=this.options[e];typeof t=="function"&&this.on(e,t,this)},this),this.model instanceof n.Model&&this.model.on("destroy",this.stop,this),this.stop({silent:!0})},start:function(e){return this.active()===!0?this:(e=e||{},e.silent||this.trigger("start",this.model),this.options.active=!0,o(this),this)},stop:function(e){return e=e||{},e.silent||this.trigger("stop",this.model),this.options.active=!1,this.xhr&&typeof this.xhr.abort=="function"&&this.xhr.abort(),this.xhr=null,window.clearTimeout(this.timeoutId),this.timeoutId=null,this},active:function(){return this.options.active===!0}});var u=[],a={find:function(e){return t.find(u,function(t){return t.model===e})},getPoller:function(e,t){var n=this.find(e);return t=t||{},n?n.set(t):(n=new s(e,t),u.push(n)),t.autostart===!0&&n.start({silent:!0}),n},size:function(){return u.length},reset:function(){t.each(u,function(e){e.stop(),e=null}),u=[]}};e.PollingManager=a}(this,this._,this.Backbone);