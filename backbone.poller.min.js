// (c) 2012 Uzi Kilon, Splunk Inc.
// Backbone Poller 0.2
// https://github.com/uzikilon/backbone-poller
// Backbone Poller may be freely distributed under the MIT license.
Backbone.Poller=function(e,t){"use strict";function s(t){if(t.active()!==!0){t.stop({silent:!0});return}var n=e.extend({},t.options,{success:function(){t.trigger("success",t.model),t.options.condition(t.model)!==!0?(t.trigger("complete",t.model),t.stop({silent:!0})):t.timeoutId=e.delay(s,t.options.delay,t)},error:function(){t.stop({silent:!0}),t.trigger("error",t.model)}});t.trigger("fetch",t.model),t.xhr=t.model.fetch(n)}function a(){console&&console.warn.apply(console,arguments)}var n={delay:1e3,condition:function(){return!0}},r=["start","stop","success","error","complete","fetch"],i=function(e,t){this.model=e,this.set(t)};e.extend(i.prototype,t.Events,{set:function(i){return this.off(),this.options=e.extend({},n,i||{}),e.each(r,function(t){var n=this.options[t];e.isFunction(n)&&this.on(t,n,this)},this),this.model instanceof t.Model&&this.model.on("destroy",this.stop,this),this.stop({silent:!0})},start:function(e){return this.active()===!0?this:(e=e||{},e.silent||this.trigger("start",this.model),this.options.active=!0,s(this),this)},stop:function(e){return e=e||{},e.silent||this.trigger("stop",this.model),this.options.active=!1,this.xhr&&this.xhr.abort&&this.xhr.abort(),this.xhr=null,clearTimeout(this.timeoutId),this.timeoutId=null,this},active:function(){return this.options.active===!0}});var o=[],u={find:function(t){return e.find(o,function(e){return e.model===t})},get:function(e,t){var n=this.find(e);return n?n.set(t):(n=new i(e,t),o.push(n)),t&&t.autostart===!0&&n.start({silent:!0}),n},getPoller:function(){return a("getPoller() is depreacted, Use Backbone.Poller.get()"),this.get.apply(this,arguments)},size:function(){return o.length},reset:function(){var e;while(e=o.pop())e.stop()}};return typeof define=="function"&&define.amd&&define(function(){return u}),window.PollingManager=u,u}(_,Backbone);